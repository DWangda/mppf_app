<ion-content [fullscreen]="true" class="ion-padding">
  <!-- ────── STEP 0 – WELCOME ────── -->
  <ng-container *ngIf="step === 'welcome'">
    <!-- <div class="ion-text-center">
      <img src="assets/images/logo.png" width="130" />
      <ion-button expand="block" (click)="startLogin()">
        <ion-icon name="qr-code-outline" slot="start"></ion-icon>
        Login with Bhutan NDI
      </ion-button>
    </div> -->
    <div class="centered">
      <img src="assets/logo1.png" class="logo" alt="App Logo" />
      <p class="login-text1"></p>
      <p class="login-text2">Pensioner Liveliness Verification App</p>
      <!-- <p class="login-text2">{{ 'LOGIN.TITLE' | translate }}</p> -->

      <!-- toggle appears on the right of the toolbar -->
      <app-language-toggle></app-language-toggle>
      <div class="button-group">
        <ion-button
          mode="ios"
          expand="block"
          fill="outline"
          style="
            width: 80%;

            --background: transparent;
            --background-activated: #124143;
            --border-width: 2px;
            --border-color: #5ac994;
            --padding-top: 0;
            --padding-bottom: 0;
            color: #ffffff;
            display: flex;
            justify-content: center;
            flex-direction: row;
          "
          (click)="startLogin()"
        >
          <img src="assets/QRlogo.svg" class="button-logo" alt="App Logo" />
          <p style="font-size: 18px; color: #333; font: bold">
            Login with Bhutan NDI
          </p>
        </ion-button>
      </div>
      <div class="button-group1">
        <ion-button
          mode="ios"
          expand="block"
          fill="outline"
          [href]="'tel:1039'"
          target="_system"
          style="
            width: 80%;
            --background: transparent;
            --background-activated: #124143;
            --border-width: 2px;
            --border-color: #5ac994;
            --padding-top: 0;
            --padding-bottom: 0;
            color: #ffffff;
            display: flex;
            justify-content: center;
            flex-direction: row;
          "
        >
          <img
            src="assets/contactIcons/phone.svg"
            class="button-logo1"
            alt="App Logo"
          />
          <p style="font-size: 18px; color: #333; font: bold">Toll Free</p>
        </ion-button>
      </div>
    </div>
  </ng-container>

  <!-- ────── STEP 1 – QR SCAN ────── -->
  <ng-container *ngIf="step === 'qr'">
    <!-- mobile shortcut -->
    <div class="scan-container">
      <div
        style="
          padding: 0;
          margin: 0;
          display: flex;
          justify-content: center;
          align-items: center;
        "
      >
        <h2
          style="
            font-size: 18px;
            font: semi-bold;
            padding: 0;
            margin: 0;
            font-weight: 600;
          "
        >
          Login with
          <span
            style="
              font-size: 18px;
              font: semi-bold;
              color: green;
              font-weight: 600;
            "
            >Bhutan NDI
          </span>
          Wallet
        </h2>
      </div>
      <ion-button
        mode="ios"
        expand="block"
        style="padding-top: 30px; --background: #28c27d"
        class="ion-margin-bottom ion-hide-md-up"
        (click)="openDeeplink()"
      >
        Open Bhutan NDI Wallet
      </ion-button>
      <div class="line-with-text">
        <span>OR</span>
      </div>
      <div class="ion-text-center">
        <!-- <h2>Scan with Bhutan NDI Wallet</h2> -->

        <!-- QR area -->
        <div
          class="qrcode-box ion-margin"
          *ngIf="!loading && !denied; else deniedTpl"
        >
          <!-- qr-code component -->
          <qrcode
            class="my-qr"
            [qrdata]="proofRequestUrl"
            [width]="160"
            [errorCorrectionLevel]="'M'"
          ></qrcode>
        </div>

        <!-- loading spinner -->

        <!-- instructions -->
        <ion-list lines="none" style="margin: 0">
          <ol style="margin: 0">
            <li style="text-align: left">
              Open Bhutan NDI Wallet on your phone
            </li>
            <li style="text-align: left">
              Tap the Scan button
              <img src="assets/ndi/scaniconimg.svg" alt="" class="scan-icon" />
              located at the menu bar and scan the QR code
            </li>
          </ol>
        </ion-list>
        <ion-button class="video-guide-btn" (click)="openVideoGuide()">
          <span>Watch video guide</span>
          <span class="play-circle"
            ><img src="assets/ndi/hoverPlayButton.svg" alt="play"
          /></span>
        </ion-button>

        <div style="margin-top: 30px">
          <p style="margin: 0">Don't have the Bhutan NDI Wallet?</p>
          <p style="color: #5ac994; margin: 0">Download Now!</p>
        </div>
        <div
          style="
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
          "
        >
          <a
            href="https://play.google.com/store/search?q=bhutan%20ndi&c=apps&hl=en_IN&gl=US"
          >
            <img
              src="https://www.citizenservices.gov.bt/NDI/assets/PlayStore.png"
              className="h-[37px]"
            />
          </a>
          <a href="https://apps.apple.com/in/app/bhutan-ndi/id1645493166">
            <img
              src="https://www.citizenservices.gov.bt/NDI/assets/AppStore.png"
              className="h-[37px]"
            />
          </a>
        </div>
        <div>
          <p style="margin: 0; margin-top: 30px; color: #5ac994">Get support</p>
        </div>
        <div
          style="
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
          "
        >
          <p style="margin: 0; display: flex; align-items: center">
            <img
              src="assets/ndi/Mail.svg"
              alt=""
              style="
                display: inline-flex;
                width: 20px;
                height: 20px;
                margin-right: 5px;
              "
            />ndifeedbach&#64;dhi.bt
          </p>
          <p style="margin: 0; display: flex; align-items: center">
            <img
              src="assets/ndi/Call.svg"
              alt=""
              style="
                display: inline-flex;
                width: 20px;
                height: 20px;
                margin-right: 5px;
              "
            />1199
          </p>
        </div>
      </div>

      <!-- template shown after “Access Denied” -->
      <ng-template #deniedTpl>
        <ion-spinner *ngIf="loading"></ion-spinner>
        <h3 class="ion-text-danger"></h3>
        <ion-button (click)="tryAgain()">Try again</ion-button>
      </ng-template>
    </div>
    <ion-button fill="clear" color="medium" (click)="step = 'welcome'">
      Back
    </ion-button>
  </ng-container>
</ion-content>
